---
version: '3'

networks:
    kafka-net:
      driver: bridge

services:
    # selenium-tests:
    #     build:
    #       context: .
    #       dockerfile: docker/selenium-tests/Dockerfile
    zookeeper-server:
        image: 'bitnami/zookeeper:latest'
        networks:
        - kafka-net
        ports:
        - '2181:2181'
        environment:
        - ALLOW_ANONYMOUS_LOGIN=yes

    kafka-server:
        image: 'bitnami/kafka:latest'
        networks:
        - kafka-net    
        ports:
        - '9092:9092'
        environment:
        - KAFKA_ZOOKEEPER_CONNECT=zookeeper-server:2181
        - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092
        - ALLOW_PLAINTEXT_LISTENER=yes
        depends_on:
        - zookeeper-server

    # kafka-server2:
    #     image: 'bitnami/kafka:latest'
    #     networks:
    #     - kafka-net    
    #     ports:
    #     - '9093:9092'
    #     environment:
    #     - KAFKA_ZOOKEEPER_CONNECT=zookeeper-server:2181
    #     - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9093
    #     - ALLOW_PLAINTEXT_LISTENER=yes
    #     depends_on:
    #     - zookeeper-server

    timescaledb:
        image: timescale/timescaledb:1.7.1-pg11
        environment:
            POSTGRES_DB: postgres
            POSTRES_USER: postgres
            POSTGRES_PASSWORD: password
        volumes:
            - ./db-data:/var/lib/postgresql/data
        ports:
            - "5432:5432"
        restart: unless-stopped
    
    pgadmin:
        image: dpage/pgadmin4:4.25
        depends_on: 
            - timescaledb
        environment:
            PGADMIN_DEFAULT_EMAIL: admin@linuxhint.com
            PGADMIN_DEFAULT_PASSWORD: secret
            PGADMIN_LISTEN_PORT: 80
        ports:
            - "8080:80"
        volumes:
            - ./pgadmin-data:/var/lib/pgadmin
        links:
            - "timescaledb:pgsql-server"
        restart: unless-stopped
        
volumes:
    db-data:
    pgadmin-data: